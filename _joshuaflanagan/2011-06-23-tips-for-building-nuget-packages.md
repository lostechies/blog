---
id: 3976
title: Tips for building Nuget packages
date: 2011-06-23T22:24:26+00:00
author: Joshua Flanagan
layout: post
guid: http://lostechies.com/joshuaflanagan/2011/06/23/tips-for-building-nuget-packages/
dsq_thread_id:
  - "340843680"
categories:
  - Uncategorized
---
&nbsp;

I&#8217;ve spent a lot of time over the past couple weeks building and consuming Nuget packages on real projects. I&#8217;ve picked up a few tips that, while not mind-blowing, should help you get beyond the simple scenarios you see in most demos.&nbsp; I&#8217;ll refer to <a href="https://github.com/DarthFubuMVC/bottles/blob/6d82e063fd889ac1909c98adc369a97b4c1e377e/packaging/nuget/bottles.nuspec" target="_blank">an example .nuspec</a> from one of my projects, so you may want to keep it open in your browser.

## Do not store the version number in your nuspec file

I assume you already had a build script before Nuget came. You already have a way to generate and store the version of your build output. For example, I tend to store the first three components of the version in a VERSION.txt file in my code repository. It gets manually incremented when appropriate (see <a href="http://semver.org/" target="_blank">semver</a>). The fourth component is the build number generated by my continuous integration server. This information is already used to generate my AssemblyInfo.cs file, artifacts package name, etc. It doesn&#8217;t make any sense for me to repeat that information in my .nuspec file, so set the version tag to 0.0.0 (see line 5) to remind yourself that it is not used. Use the -Version option of the nuget.exe <font face="Courier New">pack</font> command to provide the actual version.

## Prefer the <files> element approach to adding files to your package

Again, you already have a build script, and it likely copies all of your build output to a known location. It doesn&#8217;t make sense to copy the files around even more to build the structure required by Nuget&#8217;s &#8220;conventional folders&#8221; approach. Instead, use the <files> section of your .nuspec (see line 20) to refer to the files in your build output folder. The powerful wildcard support makes it easy to include everything you want, including source code, as suggested by the next tip&#8230;

## Publish symbols packages for your Nugets

Nuget has integrated support for building and publishing symbol packages to <a href="http://www.symbolsource.org/" target="_blank">symbolsource.org</a>. These symbol packages will greatly enhance the debugging experience for anyone that uses your library, and since its so easy, there is no reason for you to not publish them (assuming your library is open source).

  1. Include .pdb files for the files in the package&#8217;s lib folder (see line 22) 
      * Include all of the corresponding source files in the package&#8217;s src folder. Using the filespec wildcard support, this can be one line (see line 23). 
          * Pass the -Symbols flag to the <font face="Courier New">nuget.exe pack</font> command when building your package. It will create two files: yourpackage.nupkg and yourpackage.symbols.nupkg. 
              * (optional, but recommended) Register at symbolsource.org and associate your Nuget.org API key with your account. 
                  * A single call to <font face="Courier New">nuget.exe push yourpackage.nupkg</font> will upload yourpackage.nupkg to nuget.org and yourpackage.symbols.nupkg to symbolsource.org. </ol> 
                SymbolSource has good instructions on how package consumers can <a href="http://www.symbolsource.org/Public/Home/VisualStudio" target="_blank">configure Visual Studio to use the symbol packages</a>.
                
                ## Provide multiple packages that target different usage scenarios
                
                A single source code repository may produce many build artifacts, but if they aren&#8217;t always used together, they shouldn&#8217;t be distributed via Nuget together. Instead, create a single Nuget package that targets each scenario. A perfect example of what _not_ to do is the NUnit.2.5.10.11092 package (I don&#8217;t mean to pick on NUnit, it was probably created quickly by a volunteer just to get it out there. That&#8217;s cool, I get it. If anyone from the NUnit team wants my help fixing the packages, just contact me). When you install NUnit via Nuget, you get nunit.framework.dll, nunit.mocks.dll and pnunit.framework.dll added to your project. I would guess that 90% of users just want nunit.framework.dll. Similarly, the tools folder contains a number of executables, but I bet most people just want nunit-console.exe. I would break this up into an NUnit package (nunit.framework.dll in lib and all files needed to run nunit-console.exe in tools), an NUnit.Mocks package (nunit.mocks.dll in lib and has the NUnit package as a dependency), and an NUnit.Parallel package (all of the pnunit files with a dependency on NUnit if needed). The bottles.nuspec in my example is just <a href="https://github.com/DarthFubuMVC/bottles/tree/d94241ff8ee4582428e73a3e3324a9b5c875f30b/packaging/nuget" target="_blank">one of many packages</a> produced by the bottles source code repository.
                
                ## **Create _core_ packages that work outside of Visual Studio**
                
                The powershell scripts and web.config modifications are cool, but if they are not absolutely necessary to use your library, provide a &#8220;core&#8221; package that does not include them. You can always provide a &#8220;quickstart&#8221; package with these extras, and have it depend on your core package to bring in the meat.
                
                ## Automate building and publishing your packages
                
                If you follow my previous two tips, you&#8217;ll have multiple .nuspec files to deal with. Fortunately, it is easy to add a single step to your build process to create all of your packages. I have a <a href="https://gist.github.com/1044131" target="_blank">gist with a couple examples</a> to get you started (feel free to fork to improve or add more examples). It should be fairly straightforward to make new scripts to publish your packages based on those examples.
                
                I feel pretty strongly about only pushing &#8220;public CI builds&#8221; to the official Nuget feed, for traceability. This makes the publishing step a little more complex, but nothing that can&#8217;t be handled in a rake script. <a href="https://gist.github.com/1044142" target="_blank">I&#8217;ve got an example</a> that downloads the .nupkg files built on <http://teamcity.codebetter.com> and then publishes them.
                
                ## Create an icon for your package
                
                The icon will show up on nuget.org and in the Visual Studio Nuget dialog. Not many people do it (right now), so your packages will stand out. Let GitHub serve your icon file &#8211; just browse to the icon in your repo on GitHub, and then copy the link for the &#8220;raw&#8221; url and include it as your <iconUrl> metadata. Might as well do the same for your <licenseUrl>.
                
                ## Install <a href="http://nuget.codeplex.com/releases/view/59864" target="_blank">Nuget Package Explorer</a>
                
                This probably should have been the first tip, its that useful. Makes it much easier to view the contents and metadata in your local .nupkg files, and download packages from nuget.org. Invaluable when designing your packages. It even lets you edit your packages, though I&#8217;ve never tried that.